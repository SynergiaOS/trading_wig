#!/bin/bash
# Railway Dashboard Setup Helper
# Generuje komendy i instrukcje dla Railway Dashboard

set -euo pipefail

# Configuration
PROJECT_NAME="${PROJECT_NAME:-WIG}"
REPO="${REPO:-SynergiaOS/trading_wig}"

# Logging functions
log() {
    echo "[$(date '+%Y-%m-%d %H:%M:%S')] $*"
}

echo "â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—"
echo "â•‘     ğŸš€ RAILWAY DASHBOARD SETUP HELPER                         â•‘"
echo "â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
echo ""
echo "Ten skrypt generuje wszystkie komendy i instrukcje potrzebne"
echo "do konfiguracji projektu $PROJECT_NAME w Railway Dashboard."
echo ""
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"

log "ğŸ“‹ PROJEKT: $PROJECT_NAME"
log "ğŸ“¦ REPO: $REPO"
echo ""
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo ""

# ============================================================================
# KROK 1: Utworzenie projektu
# ============================================================================
log "ğŸ”¹ KROK 1: UTWORZENIE PROJEKTU"
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo ""
echo "1. OtwÃ³rz Railway Dashboard:"
echo "   https://railway.app"
echo ""
echo "2. Kliknij 'New Project'"
echo ""
echo "3. Nazwa projektu: $PROJECT_NAME"
echo ""
echo "4. Environment: production (domyÅ›lny)"
echo ""
read -p "NaciÅ›nij Enter gdy projekt bÄ™dzie utworzony..."

# ============================================================================
# KROK 2: Frontend Service
# ============================================================================
echo ""
log "ğŸ”¹ KROK 2: FRONTEND SERVICE"
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo ""
echo "1. W projekcie kliknij '+ New Service'"
echo "2. Wybierz 'GitHub Repo' â†’ $REPO"
echo "3. Nazwa serwisu: frontend"
echo ""
echo "4. Settings â†’ Build:"
echo "   Dockerfile Path: Dockerfile.frontend"
echo ""
echo "5. Settings â†’ Deploy:"
echo "   Health Check Path: /"
echo "   Health Check Timeout: 100"
echo "   Restart Policy: ON_FAILURE"
echo "   Max Retries: 10"
echo ""
echo "6. Settings â†’ Networking:"
echo "   Kliknij 'Generate Domain'"
echo ""
echo "7. Settings â†’ Variables (dodaj):"
echo "   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”"
echo "   â”‚ NODE_ENV=production                     â”‚"
echo "   â”‚ PORT=4173                               â”‚"
echo "   â”‚ VITE_REFRESH_INTERVAL=30000             â”‚"
echo "   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜"
echo ""
echo "   âš ï¸  UWAGA: VITE_API_URL i VITE_ANALYSIS_API_URL"
echo "              dodasz po deploy Backend i Analysis"
echo ""
read -p "NaciÅ›nij Enter gdy Frontend bÄ™dzie skonfigurowany..."

# ============================================================================
# KROK 3: Backend Service
# ============================================================================
echo ""
log "ğŸ”¹ KROK 3: BACKEND SERVICE"
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo ""
echo "1. Kliknij '+ New Service'"
echo "2. Wybierz 'GitHub Repo' â†’ $REPO"
echo "3. Nazwa serwisu: backend"
echo ""
echo "4. Settings â†’ Build:"
echo "   Dockerfile Path: Dockerfile.backend"
echo ""
echo "5. Settings â†’ Deploy:"
echo "   Health Check Path: /data"
echo "   Health Check Timeout: 100"
echo ""
echo "6. Settings â†’ Networking:"
echo "   Kliknij 'Generate Domain'"
echo "   ğŸ“ SKOPIUJ URL: https://backend-production-XXXX.up.railway.app"
echo ""
echo "7. Settings â†’ Variables (dodaj):"
echo "   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”"
echo "   â”‚ PORT=8000                               â”‚"
echo "   â”‚ HOST=0.0.0.0                            â”‚"
echo "   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜"
echo ""
echo "   ğŸ“ Opcjonalnie (jeÅ›li masz osobne serwisy dla baz danych):"
echo "   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”"
echo "   â”‚ POCKETBASE_URL=http://pocketbase.railway.internal:8090    â”‚"
echo "   â”‚ QUESTDB_HOST=questdb.railway.internal                     â”‚"
echo "   â”‚ QUESTDB_PORT=9009                                          â”‚"
echo "   â”‚ QUESTDB_USER=admin                                         â”‚"
echo "   â”‚ QUESTDB_PASSWORD=quest                                     â”‚"
echo "   â”‚ REDIS_URL=redis://redis.railway.internal:6379             â”‚"
echo "   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜"
echo ""
read -p "Podaj Backend URL (skopiuj z Railway): " BACKEND_URL
BACKEND_URL=${BACKEND_URL:-https://backend-production.up.railway.app}
echo "âœ… Backend URL: $BACKEND_URL"
echo ""
read -p "NaciÅ›nij Enter gdy Backend bÄ™dzie skonfigurowany..."

# ============================================================================
# KROK 4: Analysis Service
# ============================================================================
echo ""
log "ğŸ”¹ KROK 4: ANALYSIS SERVICE"
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo ""
echo "1. Kliknij '+ New Service'"
echo "2. Wybierz 'GitHub Repo' â†’ $REPO"
echo "3. Nazwa serwisu: analysis"
echo ""
echo "4. Settings â†’ Build:"
echo "   Dockerfile Path: Dockerfile.analysis"
echo ""
echo "5. Settings â†’ Deploy:"
echo "   Health Check Path: /api/analysis"
echo "   Health Check Timeout: 100"
echo ""
echo "6. Settings â†’ Networking:"
echo "   Kliknij 'Generate Domain'"
echo "   ğŸ“ SKOPIUJ URL: https://analysis-production-XXXX.up.railway.app"
echo ""
echo "7. Settings â†’ Variables (dodaj):"
echo "   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”"
echo "   â”‚ ANALYSIS_PORT=8001                      â”‚"
echo "   â”‚ ANALYSIS_HOST=0.0.0.0                   â”‚"
echo "   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜"
echo ""
echo "   ğŸ“ Opcjonalnie (te same co Backend):"
echo "   POCKETBASE_URL, QUESTDB_HOST, QUESTDB_PORT, etc."
echo ""
read -p "Podaj Analysis URL (skopiuj z Railway): " ANALYSIS_URL
ANALYSIS_URL=${ANALYSIS_URL:-https://analysis-production.up.railway.app}
echo "âœ… Analysis URL: $ANALYSIS_URL"
echo ""
read -p "NaciÅ›nij Enter gdy Analysis bÄ™dzie skonfigurowany..."

# ============================================================================
# KROK 5: Zaktualizuj Frontend Variables
# ============================================================================
echo ""
log "ğŸ”¹ KROK 5: ZAKTUALIZUJ FRONTEND VARIABLES"
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo ""
echo "1. WrÃ³Ä‡ do Frontend Service"
echo "2. Settings â†’ Variables â†’ Add Variable"
echo "3. Dodaj nastÄ™pujÄ…ce zmienne:"
echo ""
echo "   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”"
echo "   â”‚ VITE_API_URL=$BACKEND_URL"
echo "   â”‚ VITE_ANALYSIS_API_URL=$ANALYSIS_URL"
echo "   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜"
echo ""
echo "4. Railway automatycznie redeploy Frontend po zmianie zmiennych"
echo ""
read -p "NaciÅ›nij Enter gdy Frontend variables bÄ™dÄ… zaktualizowane..."

# ============================================================================
# PODSUMOWANIE
# ============================================================================
echo ""
echo "â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—"
echo "â•‘     âœ… KONFIGURACJA ZAKOÅƒCZONA!                               â•‘"
echo "â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
echo ""
echo "ğŸ“‹ PODSUMOWANIE:"
echo ""
echo "âœ… Projekt: $PROJECT_NAME"
echo "âœ… Frontend URL: (sprawdÅº w Railway Dashboard)"
echo "âœ… Backend URL: $BACKEND_URL"
echo "âœ… Analysis URL: $ANALYSIS_URL"
echo ""
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo "ğŸ“ WERYFIKACJA:"
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo ""
echo "SprawdÅº czy wszystkie serwisy dziaÅ‚ajÄ…:"
echo ""
echo "# Frontend"
echo "curl https://frontend-production-XXXX.up.railway.app"
echo ""
echo "# Backend"
echo "curl $BACKEND_URL/data"
echo ""
echo "# Analysis"
echo "curl $ANALYSIS_URL/api/analysis"
echo ""
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo "ğŸ“š DOKUMENTACJA:"
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo ""
echo "  ğŸ“˜ RAILWAY_COMPLETE_GUIDE.md - Kompletny przewodnik"
echo "  ğŸ“™ RAILWAY_ENV_SETUP.md - Zmienne Å›rodowiskowe"
echo "  ğŸ“— RAILWAY_FIX_AUTH.md - Naprawa autentykacji"
echo ""


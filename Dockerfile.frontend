# Dockerfile for Frontend Service
FROM node:18-alpine

# Install pnpm
RUN npm install -g pnpm@latest

WORKDIR /app

# Copy frontend directory
COPY polish-finance-platform/polish-finance-app/package.json polish-finance-platform/polish-finance-app/pnpm-lock.yaml* ./polish-finance-platform/polish-finance-app/

# Install dependencies
WORKDIR /app/polish-finance-platform/polish-finance-app
RUN pnpm install --no-frozen-lockfile

# Copy source code
COPY polish-finance-platform/polish-finance-app/ ./polish-finance-platform/polish-finance-app/

# Build frontend
RUN pnpm run build:prod

# Expose port (Railway will set PORT env var, default 4173)
EXPOSE 4173

# Start Vite preview server (serves built files)
CMD ["sh", "-c", "cd /app/polish-finance-platform/polish-finance-app && PORT=${PORT:-4173} pnpm exec vite preview --host 0.0.0.0 --port ${PORT:-4173}"]

